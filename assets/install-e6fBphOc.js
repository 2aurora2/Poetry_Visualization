import{bU as e,ai as t,K as a,ae as n,J as i,V as l,e as r,bE as s,bV as o,bW as g,aF as c,bX as h,_ as u,am as d,D as p,bY as f,aN as y,X as m,bZ as v,aO as b,a6 as x,a2 as A,a3 as S,l as L,b_ as w,b$ as M,c0 as D,bD as T,c1 as N,aR as I,af as C,a_ as P,a$ as _,c2 as k,M as E,aD as O,b1 as G}from"./installCanvasRenderer-B0UAo2nS.js";import{c as W}from"./createSeriesDataSimply-CvqqxuGx.js";import{L as B}from"./vintage-Fu1xNemR.js";var R=2*Math.PI,U=Math.PI/180;function V(e,t){return a(e.getBoxLayoutParams(),{width:t.getWidth(),height:t.getHeight()})}function Y(e,t){var a=V(e,t),l=e.get("center"),r=e.get("radius");n(r)||(r=[0,r]);var s,o,g=i(a.width,t.getWidth()),c=i(a.height,t.getHeight()),h=Math.min(g,c),u=i(r[0],h/2),d=i(r[1],h/2),p=e.coordinateSystem;if(p){var f=p.dataToPoint(l);s=f[0]||0,o=f[1]||0}else n(l)||(l=[l,l]),s=i(l[0],g)+a.x,o=i(l[1],c)+a.y;return{cx:s,cy:o,r0:u,r:d}}function X(a,n,i){n.eachSeriesByType(a,(function(a){var n=a.getData(),l=n.mapDimension("value"),r=V(a,i),s=Y(a,i),o=s.cx,g=s.cy,c=s.r,h=s.r0,u=-a.get("startAngle")*U,d=a.get("endAngle"),p=a.get("padAngle")*U;d="auto"===d?u-R:-d*U;var f=a.get("minAngle")*U+p,y=0;n.each(l,(function(e){!isNaN(e)&&y++}));var m=n.getSum(l),v=Math.PI/(m||y)*2,b=a.get("clockwise"),x=a.get("roseType"),A=a.get("stillShowZeroSum"),S=n.getDataExtent(l);S[0]=0;var L=b?1:-1,w=[u,d],M=L*p/2;e(w,!b),u=w[0],d=w[1];var D=z(a);D.startAngle=u,D.endAngle=d,D.clockwise=b;var T=Math.abs(d-u),N=T,I=0,C=u;if(n.setLayout({viewRect:r,r:c}),n.each(l,(function(e,a){var i;if(isNaN(e))n.setItemLayout(a,{angle:NaN,startAngle:NaN,endAngle:NaN,clockwise:b,cx:o,cy:g,r0:h,r:x?NaN:c});else{(i="area"!==x?0===m&&A?v:e*v:T/y)<f?(i=f,N-=f):I+=e;var l=C+L*i,r=0,s=0;p>i?s=r=C+L*i/2:(r=C+M,s=l-M),n.setItemLayout(a,{angle:i,startAngle:r,endAngle:s,clockwise:b,cx:o,cy:g,r0:h,r:x?t(e,S,[h,c]):c}),C=l}})),N<R&&y)if(N<=.001){var P=T/y;n.each(l,(function(e,t){if(!isNaN(e)){var a=n.getItemLayout(t);a.angle=P;var i=0,l=0;P<p?l=i=u+L*(t+.5)*P:(i=u+L*t*P+M,l=u+L*(t+1)*P-M),a.startAngle=i,a.endAngle=l}}))}else v=N/I,C=u,n.each(l,(function(e,t){if(!isNaN(e)){var a=n.getItemLayout(t),i=a.angle===f?f:e*v,l=0,r=0;i<p?r=l=C+L*i/2:(l=C+M,r=C+L*i-M),a.startAngle=l,a.endAngle=r,C+=L*i}}))}))}var z=l();var F=Math.PI/180;function j(e,t,a,n,i,l,r,s,o,g){if(!(e.length<2)){for(var c=e.length,u=0;u<c;u++)if("outer"===e[u].position&&"labelLine"===e[u].labelAlignTo){var d=e[u].label.x-g;e[u].linePoints[1][0]+=d,e[u].label.x=g}h(e,o,o+r)&&function(e){for(var l={list:[],maxY:0},r={list:[],maxY:0},s=0;s<e.length;s++)if("none"===e[s].labelAlignTo){var o=e[s],g=o.label.y>a?r:l,c=Math.abs(o.label.y-a);if(c>=g.maxY){var h=o.label.x-t-o.len2*i,u=n+o.len,d=Math.abs(h)<u?Math.sqrt(c*c/(1-h*h/u/u)):u;g.rB=d,g.maxY=c}g.list.push(o)}p(l),p(r)}(e)}function p(e){for(var l=e.rB,r=l*l,s=0;s<e.list.length;s++){var o=e.list[s],g=Math.abs(o.label.y-a),c=n+o.len,h=c*c,u=Math.sqrt(Math.abs((1-g*g/r)*h)),d=t+(u+o.len2)*i,p=d-o.label.x;q(o,o.targetTextWidth-p*i,!0),o.label.x=d}}}function q(e,t,a){if(void 0===a&&(a=!1),null==e.labelStyleWidth){var n=e.label,i=n.style,l=e.rect,r=i.backgroundColor,s=i.padding,o=s?s[1]+s[3]:0,g=i.overflow,c=l.width+(r?0:o);if(t<c||a){var h=l.height;if(g&&g.match("break")){n.setStyle("backgroundColor",null),n.setStyle("width",t-o);var u=n.getBoundingRect();n.setStyle("width",Math.ceil(u.width)),n.setStyle("backgroundColor",r)}else{var d=t-o,p=t<c?d:a?d>e.unconstrainedWidth?null:d:null;n.setStyle("width",p)}var f=n.getBoundingRect();l.width=f.width;var y=(n.style.margin||0)+2.1;l.height=f.height+y,l.y-=(l.height-h)/2}}}function H(e){return"center"===e.position}function Z(e){var t,a,n=e.getData(),l=[],h=!1,u=(e.get("minShowLabelAngle")||0)*F,d=n.getLayout("viewRect"),p=n.getLayout("r"),f=d.width,y=d.x,m=d.y,v=d.height;function b(e){e.ignore=!0}n.each((function(e){var o=n.getItemGraphicEl(e),g=o.shape,d=o.getTextContent(),m=o.getTextGuideLine(),v=n.getItemModel(e),x=v.getModel("label"),A=x.get("position")||v.get(["emphasis","label","position"]),S=x.get("distanceToLabelLine"),L=x.get("alignTo"),w=i(x.get("edgeDistance"),f),M=x.get("bleedMargin"),D=v.getModel("labelLine"),T=D.get("length");T=i(T,f);var N=D.get("length2");if(N=i(N,f),Math.abs(g.endAngle-g.startAngle)<u)return r(d.states,b),d.ignore=!0,void(m&&(r(m.states,b),m.ignore=!0));if(function(e){if(!e.ignore)return!0;for(var t in e.states)if(!1===e.states[t].ignore)return!0;return!1}(d)){var I,C,P,_,k=(g.startAngle+g.endAngle)/2,E=Math.cos(k),O=Math.sin(k);t=g.cx,a=g.cy;var G="inside"===A||"inner"===A;if("center"===A)I=g.cx,C=g.cy,_="center";else{var W=(G?(g.r+g.r0)/2*E:g.r*E)+t,B=(G?(g.r+g.r0)/2*O:g.r*O)+a;if(I=W+3*E,C=B+3*O,!G){var R=W+E*(T+p-g.r),U=B+O*(T+p-g.r),V=R+(E<0?-1:1)*N;I="edge"===L?E<0?y+w:y+f-w:V+(E<0?-S:S),C=U,P=[[W,B],[R,U],[V,U]]}_=G?"center":"edge"===L?E>0?"right":"left":E>0?"left":"right"}var Y=Math.PI,X=0,z=x.get("rotate");if(c(z))X=z*(Y/180);else if("center"===A)X=0;else if("radial"===z||!0===z){X=E<0?-k+Y:-k}else if("tangential"===z&&"outside"!==A&&"outer"!==A){var F=Math.atan2(E,O);F<0&&(F=2*Y+F),O>0&&(F=Y+F),X=F-Y}if(h=!!X,d.x=I,d.y=C,d.rotation=X,d.setStyle({verticalAlign:"middle"}),G){d.setStyle({align:_});var j=d.states.select;j&&(j.x+=d.x,j.y+=d.y)}else{var q=d.getBoundingRect().clone();q.applyTransform(d.getComputedTransform());var H=(d.style.margin||0)+2.1;q.y-=H/2,q.height+=H,l.push({label:d,labelLine:m,position:A,len:T,len2:N,minTurnAngle:D.get("minTurnAngle"),maxSurfaceAngle:D.get("maxSurfaceAngle"),surfaceNormal:new s(E,O),linePoints:P,textAlign:_,labelDistance:S,labelAlignTo:L,edgeDistance:w,bleedMargin:M,rect:q,unconstrainedWidth:q.width,labelStyleWidth:d.style.width})}o.setTextConfig({inside:G})}})),!h&&e.get("avoidLabelOverlap")&&function(e,t,a,n,i,l,r,s){for(var o=[],g=[],c=Number.MAX_VALUE,h=-Number.MAX_VALUE,u=0;u<e.length;u++){var d=e[u].label;H(e[u])||(d.x<t?(c=Math.min(c,d.x),o.push(e[u])):(h=Math.max(h,d.x),g.push(e[u])))}for(u=0;u<e.length;u++)if(!H(y=e[u])&&y.linePoints){if(null!=y.labelStyleWidth)continue;d=y.label;var p=y.linePoints,f=void 0;f="edge"===y.labelAlignTo?d.x<t?p[2][0]-y.labelDistance-r-y.edgeDistance:r+i-y.edgeDistance-p[2][0]-y.labelDistance:"labelLine"===y.labelAlignTo?d.x<t?c-r-y.bleedMargin:r+i-h-y.bleedMargin:d.x<t?d.x-r-y.bleedMargin:r+i-d.x-y.bleedMargin,y.targetTextWidth=f,q(y,f)}for(j(g,t,a,n,1,0,l,0,s,h),j(o,t,a,n,-1,0,l,0,s,c),u=0;u<e.length;u++){var y;if(!H(y=e[u])&&y.linePoints){d=y.label,p=y.linePoints;var m="edge"===y.labelAlignTo,v=d.style.padding,b=v?v[1]+v[3]:0,x=d.style.backgroundColor?0:b,A=y.rect.width+x,S=p[1][0]-p[2][0];m?d.x<t?p[2][0]=r+y.edgeDistance+A+y.labelDistance:p[2][0]=r+i-y.edgeDistance-A-y.labelDistance:(d.x<t?p[2][0]=d.x+y.labelDistance:p[2][0]=d.x-y.labelDistance,p[1][0]=p[2][0]+S),p[1][1]=p[2][1]=d.y}}}(l,t,a,p,f,v,y,m);for(var x=0;x<l.length;x++){var A=l[x],S=A.label,L=A.labelLine,w=isNaN(S.x)||isNaN(S.y);if(S){S.setStyle({align:A.textAlign}),w&&(r(S.states,b),S.ignore=!0);var M=S.states.select;M&&(M.x+=S.x,M.y+=S.y)}if(L){var D=A.linePoints;w||!D?(r(L.states,b),L.ignore=!0):(o(D,A.minTurnAngle),g(D,A.surfaceNormal,A.maxSurfaceAngle),L.setShape({points:D}),S.__hostTarget.textGuideLineConfig={anchor:new s(D[0][0],D[0][1])})}}}var $=function(e){function t(t,a,n){var i=e.call(this)||this;i.z2=2;var l=new d;return i.setTextContent(l),i.updateData(t,a,n,!0),i}return u(t,e),t.prototype.updateData=function(e,t,a,n){var i=this,l=e.hostModel,r=e.getItemModel(t),s=r.getModel("emphasis"),o=e.getItemLayout(t),g=p(f(r.getModel("itemStyle"),o,!0),o);if(isNaN(g.startAngle))i.setShape(g);else{if(n){i.setShape(g);var c=l.getShallow("animationType");l.ecModel.ssr?(y(i,{scaleX:0,scaleY:0},l,{dataIndex:t,isFrom:!0}),i.originX=g.cx,i.originY=g.cy):"scale"===c?(i.shape.r=o.r0,y(i,{shape:{r:o.r}},l,t)):null!=a?(i.setShape({startAngle:a,endAngle:a}),y(i,{shape:{startAngle:o.startAngle,endAngle:o.endAngle}},l,t)):(i.shape.endAngle=o.startAngle,m(i,{shape:{endAngle:o.endAngle}},l,t))}else v(i),m(i,{shape:g},l,t);i.useStyle(e.getItemVisual(t,"style")),b(i,r);var h=(o.startAngle+o.endAngle)/2,u=l.get("selectedOffset"),d=Math.cos(h)*u,A=Math.sin(h)*u,S=r.getShallow("cursor");S&&i.attr("cursor",S),this._updateLabel(l,e,t),i.ensureState("emphasis").shape=p({r:o.r+(s.get("scale")&&s.get("scaleSize")||0)},f(s.getModel("itemStyle"),o)),p(i.ensureState("select"),{x:d,y:A,shape:f(r.getModel(["select","itemStyle"]),o)}),p(i.ensureState("blur"),{shape:f(r.getModel(["blur","itemStyle"]),o)});var L=i.getTextGuideLine(),w=i.getTextContent();L&&p(L.ensureState("select"),{x:d,y:A}),p(w.ensureState("select"),{x:d,y:A}),x(this,s.get("focus"),s.get("blurScope"),s.get("disabled"))}},t.prototype._updateLabel=function(e,t,a){var n=this,i=t.getItemModel(a),l=i.getModel("labelLine"),r=t.getItemVisual(a,"style"),s=r&&r.fill,o=r&&r.opacity;A(n,S(i),{labelFetcher:t.hostModel,labelDataIndex:a,inheritColor:s,defaultOpacity:o,defaultText:e.getFormattedLabel(a,"normal")||t.getName(a)});var g=n.getTextContent();n.setTextConfig({position:null,rotation:null}),g.attr({z2:10});var c=e.get(["label","position"]);if("outside"!==c&&"outer"!==c)n.removeTextGuideLine();else{var h=this.getTextGuideLine();h||(h=new L,this.setTextGuideLine(h)),w(this,D(i),{stroke:s,opacity:M(l.get(["lineStyle","opacity"]),o,1)})}},t}(T),J=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.ignoreLabelLineUpdate=!0,t}return u(t,e),t.prototype.render=function(e,t,a,n){var i,l=e.getData(),r=this._data,s=this.group;if(!r&&l.count()>0){for(var o=l.getItemLayout(0),g=1;isNaN(o&&o.startAngle)&&g<l.count();++g)o=l.getItemLayout(g);o&&(i=o.startAngle)}if(this._emptyCircleSector&&s.remove(this._emptyCircleSector),0===l.count()&&e.get("showEmptyCircle")){var c=z(e),h=new T({shape:p(Y(e,a),c)});h.useStyle(e.getModel("emptyCircleStyle").getItemStyle()),this._emptyCircleSector=h,s.add(h)}l.diff(r).add((function(e){var t=new $(l,e,i);l.setItemGraphicEl(e,t),s.add(t)})).update((function(e,t){var a=r.getItemGraphicEl(t);a.updateData(l,e,i),a.off("click"),s.add(a),l.setItemGraphicEl(e,a)})).remove((function(t){var a=r.getItemGraphicEl(t);N(a,e,t)})).execute(),Z(e),"expansion"!==e.get("animationTypeUpdate")&&(this._data=l)},t.prototype.dispose=function(){},t.prototype.containPoint=function(e,t){var a=t.getData().getItemLayout(0);if(a){var n=e[0]-a.cx,i=e[1]-a.cy,l=Math.sqrt(n*n+i*i);return l<=a.r&&l>=a.r0}},t.type="pie",t}(I),K=l(),Q=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return u(t,e),t.prototype.init=function(t){e.prototype.init.apply(this,arguments),this.legendVisualProvider=new B(C(this.getData,this),C(this.getRawData,this)),this._defaultLabelLine(t)},t.prototype.mergeOption=function(){e.prototype.mergeOption.apply(this,arguments)},t.prototype.getInitialData=function(){return W(this,{coordDimensions:["value"],encodeDefaulter:P(_,this)})},t.prototype.getDataParams=function(t){var a=this.getData(),n=K(a),i=n.seats;if(!i){var l=[];a.each(a.mapDimension("value"),(function(e){l.push(e)})),i=n.seats=k(l,a.hostModel.get("percentPrecision"))}var r=e.prototype.getDataParams.call(this,t);return r.percent=i[t]||0,r.$vars.push("percent"),r},t.prototype._defaultLabelLine=function(e){E(e,"labelLine",["show"]);var t=e.labelLine,a=e.emphasis.labelLine;t.show=t.show&&e.label.show,a.show=a.show&&e.emphasis.label.show},t.type="series.pie",t.defaultOption={z:2,legendHoverLink:!0,colorBy:"data",center:["50%","50%"],radius:[0,"75%"],clockwise:!0,startAngle:90,endAngle:"auto",padAngle:0,minAngle:0,minShowLabelAngle:0,selectedOffset:10,percentPrecision:2,stillShowZeroSum:!0,left:0,top:0,right:0,bottom:0,width:null,height:null,label:{rotate:0,show:!0,overflow:"truncate",position:"outer",alignTo:"none",edgeDistance:"25%",bleedMargin:10,distanceToLabelLine:5},labelLine:{show:!0,length:15,length2:15,smooth:!1,minTurnAngle:90,maxSurfaceAngle:90,lineStyle:{width:1,type:"solid"}},itemStyle:{borderWidth:1,borderJoin:"round"},showEmptyCircle:!0,emptyCircleStyle:{color:"lightgray",opacity:1},labelLayout:{hideOverlap:!0},emphasis:{scale:!0,scaleSize:5},avoidLabelOverlap:!0,animationType:"expansion",animationDuration:1e3,animationTypeUpdate:"transition",animationEasingUpdate:"cubicInOut",animationDurationUpdate:500,animationEasing:"cubicInOut"},t}(O);function ee(e){e.registerChartView(J),e.registerSeriesModel(Q),G("pie",e.registerAction),e.registerLayout(P(X,"pie")),e.registerProcessor({seriesType:"pie",reset:function(e,t){var a=t.findComponents({mainType:"legend"});if(a&&a.length){var n=e.getData();n.filterSelf((function(e){for(var t=n.getName(e),i=0;i<a.length;i++)if(!a[i].isSelected(t))return!1;return!0}))}}}),e.registerProcessor(function(e){return{seriesType:e,reset:function(e,t){var a=e.getData();a.filterSelf((function(e){var t=a.mapDimension("value"),n=a.get(t,e);return!(c(n)&&!isNaN(n)&&n<0)}))}}}("pie"))}export{ee as i};
