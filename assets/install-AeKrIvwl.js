import{bS as t,f as e,aE as r,aG as o,_ as n,aC as i,aD as a,B as s,aI as p,G as l,ap as h,a4 as u,aL as d,aR as c,aB as f,bT as g}from"./installCanvasRenderer-B0UAo2nS.js";function y(n,i){return{seriesType:n,plan:t(),reset:function(t){var n=t.getData(),a=t.coordinateSystem,s=t.pipelineContext,p=i||s.large;if(a){var l=e(a.dimensions,(function(t){return n.mapDimension(t)})).slice(0,2),h=l.length,u=n.getCalculationInfo("stackResultDimension");r(n,l[0])&&(l[0]=u),r(n,l[1])&&(l[1]=u);var d=n.getStore(),c=n.getDimensionIndex(l[0]),f=n.getDimensionIndex(l[1]);return h&&{progress:function(t,e){for(var r=t.end-t.start,n=p&&o(r*h),i=[],s=[],l=t.start,u=0;l<t.end;l++){var g=void 0;if(1===h){var y=d.get(c,l);g=a.dataToPoint(y,null,s)}else i[0]=d.get(c,l),i[1]=d.get(f,l),g=a.dataToPoint(i,null,s);p?(n[u++]=g[0],n[u++]=g[1]):e.setItemLayout(l,g.slice())}p&&e.setLayout("points",n)}}}}}}var m=function(t){function e(){var r=null!==t&&t.apply(this,arguments)||this;return r.type=e.type,r.hasSymbolVisual=!0,r}return n(e,t),e.prototype.getInitialData=function(t,e){return i(null,this,{useEncodeDefaulter:!0})},e.prototype.getProgressive=function(){var t=this.option.progressive;return null==t?this.option.large?5e3:this.get("progressive"):t},e.prototype.getProgressiveThreshold=function(){var t=this.option.progressiveThreshold;return null==t?this.option.large?1e4:this.get("progressiveThreshold"):t},e.prototype.brushSelector=function(t,e,r){return r.point(e.getItemLayout(t))},e.prototype.getZLevelKey=function(){return this.getData().count()>this.getProgressiveThreshold()?this.id:""},e.type="series.scatter",e.dependencies=["grid","polar","geo","singleAxis","calendar"],e.defaultOption={coordinateSystem:"cartesian2d",z:2,legendHoverLink:!0,symbolSize:10,large:!1,largeThreshold:2e3,itemStyle:{opacity:.8},emphasis:{scale:!0},clip:!0,select:{itemStyle:{borderColor:"#212121"}},universalTransition:{divideShape:"clone"}},e}(a),v=function(){return function(){}}(),_=function(t){function e(e){var r=t.call(this,e)||this;return r._off=0,r.hoverDataIdx=-1,r}return n(e,t),e.prototype.getDefaultShape=function(){return new v},e.prototype.reset=function(){this.notClear=!1,this._off=0},e.prototype.buildPath=function(t,e){var r,o=e.points,n=e.size,i=this.symbolProxy,a=i.shape,s=t.getContext?t.getContext():t,p=s&&n[0]<4,l=this.softClipShape;if(p)this._ctx=s;else{for(this._ctx=null,r=this._off;r<o.length;){var h=o[r++],u=o[r++];isNaN(h)||isNaN(u)||(l&&!l.contain(h,u)||(a.x=h-n[0]/2,a.y=u-n[1]/2,a.width=n[0],a.height=n[1],i.buildPath(t,a,!0)))}this.incremental&&(this._off=r,this.notClear=!0)}},e.prototype.afterBrush=function(){var t,e=this.shape,r=e.points,o=e.size,n=this._ctx,i=this.softClipShape;if(n){for(t=this._off;t<r.length;){var a=r[t++],s=r[t++];isNaN(a)||isNaN(s)||(i&&!i.contain(a,s)||n.fillRect(a-o[0]/2,s-o[1]/2,o[0],o[1]))}this.incremental&&(this._off=t,this.notClear=!0)}},e.prototype.findDataIndex=function(t,e){for(var r=this.shape,o=r.points,n=r.size,i=Math.max(n[0],4),a=Math.max(n[1],4),s=o.length/2-1;s>=0;s--){var p=2*s,l=o[p]-i/2,h=o[p+1]-a/2;if(t>=l&&e>=h&&t<=l+i&&e<=h+a)return s}return-1},e.prototype.contain=function(t,e){var r=this.transformCoordToLocal(t,e),o=this.getBoundingRect();return t=r[0],e=r[1],o.contain(t,e)?(this.hoverDataIdx=this.findDataIndex(t,e))>=0:(this.hoverDataIdx=-1,!1)},e.prototype.getBoundingRect=function(){var t=this._rect;if(!t){for(var e=this.shape,r=e.points,o=e.size,n=o[0],i=o[1],a=1/0,p=1/0,l=-1/0,h=-1/0,u=0;u<r.length;){var d=r[u++],c=r[u++];a=Math.min(d,a),l=Math.max(d,l),p=Math.min(c,p),h=Math.max(c,h)}t=this._rect=new s(a-n/2,p-i/2,l-a+n,h-p+i)}return t},e}(p),x=function(){function t(){this.group=new l}return t.prototype.updateData=function(t,e){this._clear();var r=this._create();r.setShape({points:t.getLayout("points")}),this._setCommon(r,t,e)},t.prototype.updateLayout=function(t){var e=t.getLayout("points");this.group.eachChild((function(t){if(null!=t.startIndex){var r=2*(t.endIndex-t.startIndex),o=4*t.startIndex*2;e=new Float32Array(e.buffer,o,r)}t.setShape("points",e),t.reset()}))},t.prototype.incrementalPrepareUpdate=function(t){this._clear()},t.prototype.incrementalUpdate=function(t,e,r){var o=this._newAdded[0],n=e.getLayout("points"),i=o&&o.shape.points;if(i&&i.length<2e4){var a=i.length,s=new Float32Array(a+n.length);s.set(i),s.set(n,a),o.endIndex=t.end,o.setShape({points:s})}else{this._newAdded=[];var p=this._create();p.startIndex=t.start,p.endIndex=t.end,p.incremental=!0,p.setShape({points:n}),this._setCommon(p,e,r)}},t.prototype.eachRendered=function(t){this._newAdded[0]&&t(this._newAdded[0])},t.prototype._create=function(){var t=new _({cursor:"default"});return t.ignoreCoarsePointer=!0,this.group.add(t),this._newAdded.push(t),t},t.prototype._setCommon=function(t,e,r){var o=e.hostModel;r=r||{};var n=e.getVisual("symbolSize");t.setShape("size",n instanceof Array?n:[n,n]),t.softClipShape=r.clipShape||null,t.symbolProxy=h(e.getVisual("symbol"),0,0,0,0),t.setColor=t.symbolProxy.setColor;var i=t.shape.size[0]<4;t.useStyle(o.getModel("itemStyle").getItemStyle(i?["color","shadowBlur","shadowColor"]:["color"]));var a=e.getVisual("style"),s=a&&a.fill;s&&t.setColor(s);var p=u(t);p.seriesIndex=o.seriesIndex,t.on("mousemove",(function(e){p.dataIndex=null;var r=t.hoverDataIdx;r>=0&&(p.dataIndex=r+(t.startIndex||0))}))},t.prototype.remove=function(){this._clear()},t.prototype._clear=function(){this._newAdded=[],this.group.removeAll()},t}(),D=function(t){function e(){var r=null!==t&&t.apply(this,arguments)||this;return r.type=e.type,r}return n(e,t),e.prototype.render=function(t,e,r){var o=t.getData();this._updateSymbolDraw(o,t).updateData(o,{clipShape:this._getClipShape(t)}),this._finished=!0},e.prototype.incrementalPrepareRender=function(t,e,r){var o=t.getData();this._updateSymbolDraw(o,t).incrementalPrepareUpdate(o),this._finished=!1},e.prototype.incrementalRender=function(t,e,r){this._symbolDraw.incrementalUpdate(t,e.getData(),{clipShape:this._getClipShape(e)}),this._finished=t.end===e.getData().count()},e.prototype.updateTransform=function(t,e,r){var o=t.getData();if(this.group.dirty(),!this._finished||o.count()>1e4)return{update:!0};var n=y("").reset(t,e,r);n.progress&&n.progress({start:0,end:o.count(),count:o.count()},o),this._symbolDraw.updateLayout(o)},e.prototype.eachRendered=function(t){this._symbolDraw&&this._symbolDraw.eachRendered(t)},e.prototype._getClipShape=function(t){if(t.get("clip",!0)){var e=t.coordinateSystem;return e&&e.getArea&&e.getArea(.1)}},e.prototype._updateSymbolDraw=function(t,e){var r=this._symbolDraw,o=e.pipelineContext.large;return r&&o===this._isLargeDraw||(r&&r.remove(),r=this._symbolDraw=o?new x:new d,this._isLargeDraw=o,this.group.removeAll()),this.group.add(r.group),r},e.prototype.remove=function(t,e){this._symbolDraw&&this._symbolDraw.remove(!0),this._symbolDraw=null},e.prototype.dispose=function(){},e.type="scatter",e}(c);function S(t){f(g),t.registerSeriesModel(m),t.registerChartView(D),t.registerLayout(y("scatter"))}export{S as i,y as p};
